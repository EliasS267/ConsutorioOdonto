<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Consultório Odontológico</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Cabeçalho -->
    <h1>Consultório Odontológico</h1>

    <!-- Menu -->
    <nav>
      <button onclick="mostrar('cadastro')">Clientes</button>
      <button onclick="mostrar('lista')">Lista de Clientes</button>
      <button onclick="mostrar('agendamentos')">Agendamentos</button>
      <button onclick="mostrar('agenda_hoje')">Agenda do dia</button>
    </nav>

    <!-- Seção Cadastro -->
    <section id="cadastro">
      <h2>Cadastrar Cliente</h2>
      <form id="formCliente">
        <input
          type="text"
          id="nome"
          name="nome"
          placeholder="Nome do Cliente"
          required
        />
        <input
          type="text"
          id="telefone"
          name="telefone"
          placeholder="Telefone"
          required
        />
        <input
          type="number"
          id="idade"
          name="idade"
          placeholder="Idade"
          required
        />
        <button type="submit">Cadastrar</button>
        <div id="mensagem"></div>
      </form>
    </section>

    <!-- Seção Lista de Clientes -->
    <section id="lista" style="display: none">
      <h2>Lista de Clientes</h2>

      <table border="1" width="100%">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Telefone</th>
            <th>Idade</th>
          </tr>
        </thead>
        <tbody id="tabelaClientes"></tbody>
      </table>

      <!-- Botão para atualizar a lista -->
      <button class="botao-atualizar" onclick="carregarClientes()">
        Atualizar Lista
      </button>
    </section>

    <!-- Seção Agendamentos -->
    <section id="agendamentos" style="display: none">
      <h2>Agendar</h2>
      <div id="conteudoAgendamentos"></div>
    </section>

    <!-- Seção Agenda do Dia -->
    <section id="agenda_hoje" style="display: none">
      <h2>Agenda do Dia</h2>
      <p>Em breve...</p>
    </section>

    <!-- Scripts -->
    <script>
      const API_URL = "https://consultorioodonto-production.up.railway.app";

      // Função para alternar entre seções
      function mostrar(secao) {
        document.getElementById("cadastro").style.display = "none";
        document.getElementById("lista").style.display = "none";
        document.getElementById("agendamentos").style.display = "none";
        document.getElementById("agenda_hoje").style.display = "none";

        document.getElementById(secao).style.display = "block";

        // Se abriu a lista, recarregar clientes
        if (secao === "lista") {
          carregarClientes();
        }
      }

      // Cadastrar cliente (usa rota Node.js /clientes)
      document
        .getElementById("formCliente")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const nome = document.getElementById("nome").value;
          const telefone = document.getElementById("telefone").value;
          const idade = document.getElementById("idade").value;

          try {
            const response = await fetch(`${API_URL}/clientes`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ nome, telefone, idade }),
            });

            if (response.ok) {
              const cliente = await response.json();
              alert(`Cliente ${cliente.nome} cadastrado com sucesso!`);
              this.reset();
              carregarClientes(); // já atualiza a lista depois de salvar
            } else {
              alert("Erro ao cadastrar cliente.");
            }
          } catch (error) {
            console.error(error);
            alert("Falha ao conectar com o servidor.");
          }
        });

      // Carregar clientes do banco (usa rota Node.js /clientes)
      async function carregarClientes() {
        try {
          const response = await fetch(`${API_URL}/clientes`);
          const dados = await response.json();

          let tabela = document.getElementById("tabelaClientes");
          tabela.innerHTML = "";

          dados.forEach((c) => {
            tabela.innerHTML += `
              <tr>
                <td>${c.id}</td>
                <td>${c.nome}</td>
                <td>${c.telefone}</td>
                <td>${c.idade ?? ""}</td>
              </tr>`;
          });
        } catch (error) {
          console.error("Erro ao carregar clientes:", error);
        }
      }
    </script>
  </body>
</html>
